<?xml version="1.0" encoding="utf-8"?>
<module_schema namespace="FamilienPortal\Modules">
    <module_definition name="Topic">
        <implementor>\Honeybee\Core\Dat0r\Module</implementor>
        <document_implementor>\Honeybee\Core\Dat0r\Module</document_implementor>
        <description>The "Topic" module describes an "article like" entity.</description>
        <option name="slug_pattern">{title}-{shortIdentifier}</option>
        <attributes>
            <attribute name="title" type="text">
                <description>A "Topic"s title.</description>
                <option name="mandatory">true</option>
            </attribute>

            <attribute name="description" type="textarea">
                <description>A "Topic"s description.</description>
                <option name="use_richtext">yes</option>
            </attribute>

            <attribute name="keywords" type="text-collection">
                <description>Holds a topic's "synonyms" (text-collection)attribute.</description>
            </attribute>

            <attribute name="categories" type="reference-collection">
                <description>A "Topic"s category references.</description>
                <option name="references">
                    <option>Category</option>
                </option>
            </attribute>

            <attribute name="voting_stats" type="aggregate-collection">
                <description>Keeps track of the votes a topic has received.</description>
                <option name="max">1</option>
                <option name="modules">
                    <option>VotingStats</option>
                </option>
            </attribute>

            <attribute name="location" type="aggregate-collection">
                <description>Holds an topic's location.</description>
                <option name="max">1</option>
                <option name="aggregates">
                    <option>Location</option>
                </option>
            </attribute>

            <attribute name="meta" type="key-value">
                <description>Holds a set of generic attributes.</description>
                <option name="constraints">
                    <option name="value_type">dynamic</option>
                </option>
            </attribute>

            <attribute name="workflow_ticket" type="aggregate-collection">
                <description>Holds the current workflow state.</description>
                <option name="aggregates">
                    <option>WorkflowTicket</option>
                </option>
            </attribute>
        </attributes>
    </module_definition>

    <aggregate_definitions>
        <aggregate_definition name="Location">
            <description>
                A "Location" describes a concrete adress
                together with a corresponding geo-point.
            </description>
            <attributes>
                <attribute name="street" type="text">
                    <description>Holds a location's street.</description>
                </attribute>
                <attribute name="housenumber" type="text">
                    <description>Holds a location's housenumber.</description>
                </attribute>
                <attribute name="postal_code" type="text">
                    <description>Holds a location's postal code.</description>
                </attribute>
                <attribute name="city" type="text">
                    <description>Holds a location's city.</description>
                </attribute>
                <attribute name="lon" type="number">
                    <description>Holds a location's longitude value.</description>
                    <option name="precision">float</option>
                </attribute>
                <attribute name="lat" type="number">
                    <description>Holds a location's latitude value.</description>
                    <option name="precision">float</option>
                </attribute>
            </attributes>
        </aggregate_definition>

        <aggregate_definition name="VotingStats">
            <description>
                Aggregates information on the number of votes, a max(global) score and average voting.
            </description>
            <attributes>
                <attribute name="average_score" type="number">
                    <description>Holds an average voting score ('global score' / 'number of votes').</description>
                    <option name="precision">float</option>
                </attribute>
                <attribute name="global_score" type="number">
                    <description>Holds the sum of all votings that have taken place.</description>
                </attribute>
                <attribute name="voting_count" type="number">
                    <description>Holds the number of votes that have taken place.</description>
                </attribute>
            </attributes>
        </aggregate_definition>

        <aggregate_definition name="WorkflowTicket">
            <implementor>\Honeybee\Core\Dat0r\WorkflowTicket</implementor>
            <description>
                A "WorkflowTicket" reflects the current state of an document's workflow.
            </description>
            <attributes>
                <attribute name="workflow_name" type="text">
                    <description>Holds the name of the related workflow.</description>
                </attribute>
                <attribute name="workflow_step" type="text">
                    <description>Holds the current step's name, being the cursor for the workflow execution.</description>
                </attribute>
                <attribute name="owner" type="text">
                    <description>Holds the name of the user currently owning the item.</description>
                </attribute>
                <attribute name="blocked" type="boolean">
                    <description>Tells whether we are currently open to workflow executions or not.</description>
                </attribute>
                <attribute name="step_counts" type="key-value">
                    <description>Tracks the number of executions of workflow steps.</description>
                    <option name="constraints">
                        <option name="value_type">integer</option>
                    </option>
                </attribute>
                <attribute name="wait_until" type="text">
                    <description>Holds a iso8601 date at which the workflow will be continued.</description>
                </attribute>
                <attribute name="last_result" type="aggregate-collection">
                    <description>Holds the result of the latest workflow execution.</description>
                    <option name="aggregate_modules">
                        <option>PluginResult</option>
                    </option>
                </attribute>
            </attributes>
        </aggregate_definition>

        <aggregate_definition name="PluginResult">
            <description>
                A "PluginResult" reflects the result of the latest workflow execution.
            </description>
            <attributes>
                <attribute name="state" type="number">
                    <description>Holds a success/error code representing a certain state.</description>
                </attribute>
                <attribute name="gate" type="text">
                    <description>Holds the name of the gate to use when proceeding.</description>
                </attribute>
                <attribute name="message" type="text">
                    <description>Holds an optional message that accompanies the state code.</description>
                </attribute>
            </attributes>
        </aggregate_definition>
    </aggregate_definitions>

    <reference_definition name="Category">
        <option name="module">\Honeybee\Domain\Category\CategoryModule</option>
        <option name="id_attribute">identifier</option>
        <attributes>
            <attribute name="name" type="text" />
        </attributes>
    </reference_definition>
</module_schema>
